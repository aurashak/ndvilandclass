<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manhattan Temperature & Vulnerability Analysis</title>
    <meta name="description" content="Spatial analysis of temperature distribution and demographic vulnerability in Manhattan.">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    
    <link rel="stylesheet" href="css/base-style.css">
    <link rel="stylesheet" href="css/map-components.css">
    <link rel="stylesheet" href="css/analysis-layout.css">
</head>
<body>
    
    <div class="analysis-wrapper">
        
        <div class="map-container-main">
            <div class="map-viewport">
                <div id="aqmap" style="width: 100%; height: 100%;"></div>
            </div>
            
            <div class="map-overlay-panel">
                <div class="info-card">
                    
                    <section class="panel-header">
                        <h2>Manhattan Temperature Analysis</h2>
                        <p>Spatial analysis of live temperatures and elderly population concentration per census tract. Vulnerability is assessed via standard deviation ($\sigma$) from the mean temperature.</p>
                    </section>
                
                    <div id="status-indicator">
                        <div id="status-content">
                            <p><span id="aq-status-text">Initializing Data Stream...</span></p>
                        </div>
                        <div class="loading-bar-bg">
                            <div id="aq-loading-bar"></div>
                        </div>
                    </div>
                    
                    <div class="temporal-meta">
                        <p>Last Update: <span id="last-update-date">--/--/----</span> <span id="last-update-time">--:--:--</span></p>
                        <p class="refresh-timer">Next Scheduled Update: <span id="next-update-time">--:--</span></p>
                    </div> 

                    <div class="live-stats-summary">
                        <h3>Current Distribution</h3>
                        <div class="stat-item">Mean ($\mu$): <span id="current-mean-temp">--</span>°F</div>
                        <div class="stat-item">Std Dev ($\sigma$): <span id="current-std-dev">--</span>°F</div>
                        <div class="stat-item">Range: <span id="current-min-temp">--</span>°F - <span id="current-max-temp">--</span>°F</div>
                    </div>

                    <section class="layer-controls">
                        <h4>Map Layers</h4>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-census-aqmap" checked>
                            <span class="slider"></span> Temperature Heatmap
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-elderly">
                            <span class="slider"></span> Elderly Population (65+)
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-heat-deviation">
                            <span class="slider"></span> Heat Deviation ($\sigma > 0$)
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-cold-deviation">
                            <span class="slider"></span> Cold Deviation ($\sigma < 0$)
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-heat-risk">
                            <span class="slider"></span> Heat Vulnerability Index
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-cold-risk">
                            <span class="slider"></span> Cold Vulnerability Index
                        </label>

                        <label class="control-switch">
                            <input type="checkbox" id="toggle-cumulative-heat">
                            <span class="slider"></span> Cumulative Heat Risk
                        </label>
                        
                        <label class="control-switch">
                            <input type="checkbox" id="toggle-cumulative-cold">
                            <span class="slider"></span> Cumulative Cold Risk
                        </label>
                    </section>

                    <div class="legend-stack">
                        <div class="legend-item" id="temp-legend">
                            <h5>Temperature Scale</h5>
                            <div class="gradient-bar"></div>
                            <div class="legend-labels">
                                <span>Cool</span>
                                <span>Average</span>
                                <span>Hot</span>
                            </div>
                        </div>

                        <div class="legend-item" id="risk-legend">
                            <h5>Statistical Risk Levels</h5>
                            <div class="legend-row"><span class="swatch extreme"></span> Extreme ($\ge 2\sigma$)</div>
                            <div class="legend-row"><span class="swatch very-high"></span> Very High ($1.5\sigma$ to $2\sigma$)</div>
                            <div class="legend-row"><span class="swatch high"></span> High ($1\sigma$ to $1.5\sigma$)</div>
                            <div class="legend-row"><span class="swatch elevated"></span> Elevated ($0.5\sigma$ to $1\sigma$)</div>
                        </div>
                    </div>

                </div> 
            </div> 
        </div>

        <section class="data-dashboard">
            <div class="dashboard-grid">
                
                <div class="data-card">
                    <h2>Historical Aggregate Data</h2>
                    <div class="stats-list">
                        <div class="stats-row">Census Tracts Observed: <span id="total-tracts">--</span></div>
                        <div class="stats-row">Collection Period: <span id="collection-period">--</span> days</div>
                        <div class="stats-row">Cumulative Average: <span id="global-avg-temp">--</span>°F</div>
                        <div class="stats-row">Historical Range: <span id="global-min-temp">--</span>°F - <span id="global-max-temp">--</span>°F</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="temp-distribution-chart"></canvas>
                    </div>
                </div>

                <div class="data-card">
                    <h2>Live Distribution Analysis</h2>
                    <div class="stats-list">
                        <div class="stats-row">Current Mean: <span id="current-mean-temp-b">--</span>°F</div>
                        <div class="stats-row">Current Std Dev: <span id="current-std-dev-b">--</span>°F</div>
                        <div class="stats-row">Current Span: <span id="current-temp-range-b">--</span>°F</div>
                    </div>
                    <div class="chart-wrapper">
                        <canvas id="current-temp-distribution-chart"></canvas>
                    </div>
                </div>
            </div>

            <div class="risk-grid">
                <div class="risk-card heat-focus">
                    <h3>Heat Risk Summary</h3>
                    <p>Current Hottest: Tract <span id="hottest-tract-id">--</span> (<span id="hottest-temp-f">--</span>°F)</p>
                    <div class="risk-table">
                        <div>Extreme ($\ge 2\sigma$): <span id="heat-extreme-count">--</span> tracts</div>
                        <div>Very High ($1.5-2\sigma$): <span id="heat-veryhigh-count">--</span> tracts</div>
                    </div>
                </div>

                <div class="risk-card cold-focus">
                    <h3>Cold Risk Summary</h3>
                    <p>Current Coldest: Tract <span id="coldest-tract-id">--</span> (<span id="coldest-temp-f">--</span>°F)</p>
                    <div class="risk-table">
                        <div>Extreme ($\ge 2\sigma$): <span id="cold-extreme-count">--</span> tracts</div>
                        <div>Very High ($1.5-2\sigma$): <span id="cold-veryhigh-count">--</span> tracts</div>
                    </div>
                </div>
            </div>
        </section>

        <section class="methodology-documentation">
            <h2>Methodology & Statistical Framework</h2>

            <div class="method-block">
                <h3>1. Data Sourcing</h3>
                <ul>
                    <li><strong>Meteorological:</strong> Modeled temperature data via OpenWeather API, integrating satellite thermal imaging and ground stations.</li>
                    <li><strong>Temporal Resolution:</strong> Observations collected tri-daily (02:00, 10:00, 18:00 EST).</li>
                    <li><strong>Demographic:</strong> 2020 U.S. Census data for 301 Manhattan census tracts.</li>
                </ul>
            </div>

            <div class="method-block">
                <h3>2. Statistical Calculations</h3>
                <p>Calculations are performed at each interval to establish the spatial distribution of temperature across the urban environment:</p>
                <ul>
                    <li><strong>Arithmetic Mean ($\mu$):</strong> $\mu = \frac{\sum T_i}{n}$</li>
                    <li><strong>Standard Deviation ($\sigma$):</strong> $\sigma = \sqrt{\frac{\sum(T_i - \mu)^2}{n}}$</li>
                    <li><strong>Z-Score ($Z$):</strong> $Z = \frac{T_{tract} - \mu}{\sigma}$</li>
                </ul>
            </div>

            <div class="method-block">
                <h3>3. Vulnerability Risk Scoring</h3>
                <p>The <strong>Vulnerability Score ($V_{score}$)</strong> identifies the intersection of thermal extremes and demographic sensitivity:</p>
                <blockquote>
                    $V_{score} = (|Z| \times 0.6) + (\frac{Elderly_i}{\max(Elderly)} \times 0.4)$
                </blockquote>
                <p>This weighted index prioritizes temperature deviation (60%) while accounting for high-density elderly populations (40%).</p>
            </div>
        </section>

        <footer class="sources-footer">
            <h2>References</h2>
            <ul>
                <li>OpenWeather API. (2025). Current Weather Data.</li>
                <li>U.S. Census Bureau. (2020). Decennial Census.</li>
                <li>Leaflet.js. (2025). Version 1.9.4 Open-Source Interactive Maps.</li>
            </ul>
        </footer>

    </div> <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/spatial-analysis.js"></script>
</body>
</html>
